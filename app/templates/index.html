{% import "bootstrap/wtf.html" as wtf %}

<html>

<head>
  <title>Sani Meals - Calculator</title>
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="static/stylesheets/global.css ">
  <link rel="stylesheet" type="text/css" href="static/stylesheets/nutrition_label.css ">

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min.js"></script>
  <script src="https://checkout.stripe.com/checkout.js"></script>
  <!-- For Charts -->
  <script src="http://www.google.com/jsapi"></script>
  <script src="ck/static/chartkick.js"></script>
  {#
  <script type="text/javascript" src="http://gabelerner.github.io/canvg/rgbcolor.js"></script>
  <script type="text/javascript" src="http://gabelerner.github.io/canvg/StackBlur.js"></script>
  <script type="text/javascript" src="http://gabelerner.github.io/canvg/canvg.js"></script>
  #}
</head>

<body>

  <script type="text/javascript" src="static/js/GeneticSoylent.js"></script>
  <script type="text/javascript" src="static/js/Recipe.js"></script>
  <script type="text/javascript" src="static/js/app.js"></script>
  <script type="text/javascript" src="static/js/ui.js"></script>

  <nav class="navbar navbar-default">
    <div class="container">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://mysani.com">
          <img src="static/img/logo.png" height="100" width="100">
        </a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#">Create</a></li>
          <li><a href="#">Recipes</a></li>
          <li><a href="#">Blog</a></li>
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
  </nav>


  <div class="row" style="display:none">
    <div class="col-xs-4">
      <div class="img">
        <a href="{{url_for('user')}}">
          <img src="static/img/logo.png" height="175" width="175">
        </a>
      </div>
    </div>
    <div class="col-xs-8>">
      <br />

      <form class="form-inline" align="center">
        <a href="{{url_for('user')}}"><i class="fa fa-user fa-lg">{{session['name']}}</i></a>

        <label>&nbsp;&nbsp;&nbsp;&nbsp;Generation:</label>
        <input class="generation form-control input-sm" type="text" style="width: 50px; text-align: center; margin-right: 20px; margin-left: 10px" />
        <a class="btn btn-primary start-genetic-algorithm" href="#"><i class="fa fa-play"></i></a>
        <a class="btn btn-primary pause-genetic-algorithm" href="#" style="display: none;"><i class="fa fa-pause"></i></a>
        <a class="btn btn-default step-genetic-algorithm" href="#"><i class="fa fa-step-forward"></i></a>
        <a class="btn btn-default reset-genetic-algorithm" href="#"><i class="fa fa-refresh"></i></a>
      </form>

      <div class="population">
        <form class="form-inline" align="center">
          <label>Population:</label>
          <input class="population form-control input-sm" type="text" style="width: 50px; text-align: center" value="100" />
          <label style="margin-left: 20px;">Mutation probability:</label>
          <input class="mutation-probability form-control" type="text" style="text-align: center; width: 50px" value="0.5" />
          <label style="margin-left: 20px;">Mutation multiplier:</label>
          <input class="mutation-multiplier form-control" type="text" style="text-align: center; width: 50px" value="0.1" />
          <label style="margin-left: 20px;">Death rate:</label>
          <input class="death-rate form-control input-sm" type="text" style="width: 50px; text-align: center" value="0.3" />
        </form>
        {#
        <!--           <div class="calculating"><i class="icon-spinner icon-spin icon-large"></i>Calculating...</div>   -->#}
        <button class="btn btn-default" disabled="disabled" id="clickJSON3">Reserved Button</button>
        <button class="btn btn-info" id="clickJSON">Use Sample Target 1</button>
        <button class="btn btn-info" id="clickJSON2">Use Sample Target 2</button>
      </div>
    </div>
  </div>

  <div class="calculating">
    <div class="col-xs-2"></div>
    <div class="col-xs-1"><i class="fa fa-spinner fa-spin fa-4x"></i></div>
    <div class="col-xs-9">
      <h1>Calculating...Please do not close your browser</h1>
    </div>
  </div>

  {% if nutrientMerge %}
  <div class="container">


    <div class="row nutrient-label" style="display:none">

      <div class="col-md-4">
        <section class="performance-facts">
          </tr>
          <header class="performance-facts__header">
            <h1 class="performance-facts__title">Nutrition Facts</h1>
          </header>
          <table class="performance-facts__table">
            <thead>
              <tr>
                <th colspan="3" class="small-info">
                  Amount Per Day
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th colspan="2">
                  <b>Calories  </b> {{nutrientMerge.calories}}
                </th>
              </tr>
              <tr class="thick-row">
                <td colspan="3" class="small-info">
                  <b>% Daily Value*</b>
                </td>
              </tr>
              <tr>
                <th colspan="2">
                  <b>Total Carbohydrate  </b> {{nutrientMerge.carbs}}
                </th>
                <td>
                  <b>{{ratio.carbs}}%</b>
                </td>
              </tr>
              <tr>
                <td class="blank-cell">
                </td>
                <th>
                  Dietary Fiber {{nutrientMerge.fiber}}
                </th>
                <td>
                  <b>{{ratio.fiber}}%</b>
                </td>
              </tr>
              <tr>
                <th colspan="2">
                  <b>Protein </b> {{nutrientMerge.protein}}
                </th>
                <td>
                  <b>{{ratio.protein}}%</b>
                </td>
              </tr>
              <tr>
                <th colspan="2">
                  <b>Total Fat </b> {{nutrientMerge.fat}}
                </th>
                <td>
                  <b>{{ratio.fat}}%</b>
                </td>
              </tr>
              <tr>
                <td class="blank-cell">
                </td>
                <th>
                  Saturated Fat {{nutrientMerge['saturated-fat']}}
                </th>
                <td>
                  <b>{{ratio2['saturated-fat']}}%</b>
                </td>
              </tr>
              <tr>
                <td class="blank-cell">
                </td>
                <th>
                  Monounsaturated Fat {{nutrientMerge['monounsaturated-fat']}}
                </th>
                <td>
                  <b>{{ratio2['monounsaturated-fat']}}%</b>
                </td>
              </tr>
              <tr>
                <td class="blank-cell">
                </td>
                <th>
                  Polyunsaturated Fat {{nutrientMerge['polyunsaturated-fat']}}
                </th>
                <td>
                  <b>{{ratio2['polyunsaturated-fat']}}%</b>
                </td>
              </tr>
              <tr>
                <td class="blank-cell">
                </td>
                <th>
                  Omega-3 Fatty Acids {{nutrientMerge['omega_3']}}
                </th>
                <td>
                </td>
              </tr>
              <tr>
                <td class="blank-cell">
                </td>
                <th>
                  Omega-6 Fatty Acids {{nutrientMerge['omega_6']}}
                </th>
                <td>
                </td>
              </tr>
              <tr>
                <th colspan="2">
                  <b>Sodium  </b> {{nutrientMerge['sodium']}}
                </th>
                <td>
                  <b>{{ratio2['sodium']}}%</b>
                </td>
              </tr>
              <tr>
                <tr class="thick-end">
                  <th colspan="2">
                    <b>Cholesterol</b> 0 mg
                  </th>
                  <td>
                  </td>
                </tr>
            </tbody>
          </table>

          <table class="performance-facts__table--grid">
            <tbody id="otherNutrients">
            </tbody>
            <tbody id="vitamins">
              <tr>
                <td>
                  Calcium
                </td>
                <td>
                  {{ratio2['calcium']}}%
                </td>
                <td>
                  Vitamin A
                </td>
                <td>

                  {{ratio2['vitamin_a']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Chloride
                </td>
                <td>
                  {{ratio2['chloride']}}%
                </td>
                <td>
                  Vitamin B6
                </td>
                <td>

                  {{ratio2['vitamin_b6']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Chromium
                </td>
                <td>
                  {{ratio2['chromium']}}%
                </td>
                <td>
                  Vitamin B12
                </td>
                <td>

                  {{ratio2['vitamin_b12']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Copper
                </td>
                <td>
                  {{ratio2['copper']}}%
                </td>
                <td>
                  Vitamin C
                </td>
                <td>

                  {{ratio2['vitamin_c']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Iodine
                </td>
                <td>
                  {{ratio2['iodine']}}%
                </td>
                <td>
                  Vitamin D
                </td>
                <td>

                  {{ratio2['vitamin_d']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Iron
                </td>
                <td>
                  {{ratio2['iron']}}%
                </td>
                <td>
                  Vitamin E
                </td>
                <td>

                  {{ratio2['vitamin_e']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Magnesium
                </td>
                <td>
                  {{ratio2['magnesium']}}%
                </td>
                <td>
                  Vitamin K
                </td>
                <td>

                  {{ratio2['vitamin_k']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Manganese
                </td>
                <td>
                  {{ratio2['manganese']}}%
                </td>
                <td>
                  Riboflavin
                </td>
                <td>

                  {{ratio2['riboflavin']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Molybdenum
                </td>
                <td>
                  {{ratio2['molybdenum']}}%
                </td>
                <td>
                  Niacin
                </td>
                <td>

                  {{ratio2['niacin']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Phosphorus
                </td>
                <td>
                  {{ratio2['phosphorus']}}%
                </td>
                <td>
                  Folate
                </td>
                <td>

                  {{ratio2['folate']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Selenium
                </td>
                <td>
                  {{ratio2['selenium']}}%
                </td>
                <td>
                  Pantothenic
                </td>
                <td>

                  {{ratio2['pantothenic']}}%
                </td>
              </tr>
              <tr>
                <td>
                  Sulfur
                </td>
                <td>
                  {{ratio2['sulfur']}}%
                </td>
                <td>
                  Biotin
                </td>
                <td>

                  {{ratio2['biotin']}}%
                </td>
              </tr>
              <tr class="thin-end">
                <td>
                  Zinc
                </td>
                <td>
                  {{ratio2['zinc']}}%
                </td>
                <td>

                </td>
              </tr>
            </tbody>

          </table>

          <p class="small-info">* Percent Daily Values are based on a 2000 calorie diet. Your daily values may be higher or lower depending on your calorie needs:</p>
        </section>
        <div id="ingredientTable"></div>

      </div>
      <div class="col-md-8">
        <div id="saniPicture"></div>
        <h1>YOUR PERSONALIZED SANI</h1>
        <button id="customButton">Purchase</button>

        <script>
          var handler = StripeCheckout.configure({
            key: 'pk_test_6pRNASCoBOKtIshFeQd4XMUh',
            image: '/img/documentation/checkout/marketplace.png',
            locale: 'auto',
            token: function(token) {
              // Use the token to create the charge with a server-side script.
              // You can access the token ID with `token.id`
            }
          });

          $('#customButton').on('click', function(e) {
            // Open Checkout with further options
            handler.open({
              name: 'Stripe.com',
              description: '2 widgets',
              amount: 2000
            });
            e.preventDefault();
          });

          // Close Checkout on page navigation
          $(window).on('popstate', function() {
            handler.close();
          });
        </script>
        <div class="submit" style="display:none">
          <form method="POST">

            <div style="display:none">
              {{ ingredientform.ingredientJson(placeholder="ingredientJson", class="form-control", id = "ingredientTableJsonVal", rows="3", style="width:100%") }}
            </div>
            <div style="display:none">
              {{ ingredientform.deviation(placeholder="deviation", class="form-control", id = "deviationTable", rows="1", style="width:100%") }}
            </div>
            <div style="display:none">
              {{ ingredientform.nutrient(placeholder="nutrient", class="form-control", id = "nutrientHtmlJson", rows="1", style="width:100%") }}
            </div>
            <div style="display:none">
              {{ ingredientform.nutrient2(placeholder="nutrient2", class="form-control", id = "nutrientHtmlJson2", rows="1", style="width:100%") }}
            </div>

            <div class="col-md-6">
            {{ ingredientform.orderQuantity(placeholder="nutrient2", class="form-control", id = "nutrientHtmlJson2", rows="1", style="width:100%") }}
          </div>

            {{ ingredientform.submit(class="btn btn-success btn-block") }}
          </form>
        </div>
      </div>
    </div>
  </div>

  {% else %}
  <section class="page-wrapper">

  </section>
  <div class="container">
    <div class="macros-summary">
      <h1>
        Thanks for that info! By getting to know you a bit, using a little math we calculated your ideal caloric needs using the Mifflin- St Jear formula, the indsutry standard used by most nutrionists.
      </h1>
      <div class="submit" style="display:none">
        <form method="POST">
          <div style="display:none">
            {{ ingredientform.ingredientJson(placeholder="ingredientJson", class="form-control", id = "ingredientTableJsonVal", rows="3", style="width:100%") }}
          </div>
          <div style="display:none">
            {{ ingredientform.deviation(placeholder="deviation", class="form-control", id = "deviationTable", rows="1", style="width:100%") }}
          </div>
          <div style="display:none">
            {{ ingredientform.nutrient(placeholder="nutrient", class="form-control", id = "nutrientHtmlJson", rows="1", style="width:100%") }}
          </div>
          <div style="display:none">
            {{ ingredientform.nutrient2(placeholder="nutrient2", class="form-control", id = "nutrientHtmlJson2", rows="1", style="width:100%") }}
          </div>


          {{ ingredientform.submit(class="btn-special") }}
        </form>
      </div>
    </div>
  </div>
  {% endif %}

  <div id="nutrientHtmlJson" style="display:none"></div>
  <div id="nutrientHtmlJson2" style="display:none"></div>

  <div class="col-xs-12" style="display:none">
    <h3>This is the 1st JSON</h3>
    {{ratioJson1}}
  </div>
  <div class="col-xs-12" style="display:none">
    <h3>This is the 2nd JSON</h3>
    {{ratioJson2}}
  </div>

  <div style="display:none">
    <h2>Choose Your Own Recipe.</h2>
    {% if calories %}
    <h4>By our calculation, your target is shown as below.</h4>

    <p>{"nutrientTargets": {"calories": {{calories}}, "protein": {{protein}}, "fat": {{fat}}, "carbs": {{carbs}}, "name": "{{email}}","gender": "{{gender}}", "age": {{age}} }}</p>
    {% endif %}
    <textarea class="form-control" id="inputJSON" rows="1" style="width:100%">
      {% if calories %} {"nutrientTargets": {"calories": {{calories}}, "protein": {{protein}}, "fat": {{fat}}, "carbs": {{carbs}}, "name": "{{email}}","gender": "{{gender}}", "age": {{age}} }} {% endif %}
    </textarea>
  </div>

  {#
  <!--
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<script type=text/javascript>
  $(function() {
    $('a#calculate').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/_add_numbers', {
        a: $('input[name="a"]').val(),
        b: $('input[name="b"]').val()
      }, function(data) {
        $("#result").text(data.ingredients);
      });
      return false;
    });
  });
</script>

<div class="cc">
<h1>jQuery Example</h1>
<p><input type=text size=5 name=a> +
   <input type=text size=5 name=b> =
   <span id="result">?</span></p>
<p><a href=# id="calculate">calculate server side</a>
</p></div>


<script type=text/javascript>
  $(function() {
    $('a#calculate').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/_json', {
        ingredients: $('textarea[name="a"]').val()
      }, function(data) {
        $("#result").text(data.ingredients);
      });
      return false;
    });
  });
</script>

<div class="cc">
<h1>jQuery Example</h1>
<p><textarea name=a id="ingredientTableJsonVal" rows="2" style="width:100%"></textarea></p>
<p><span id="result">?</span></p>
<p><a href=# id="calculate">calculate server side</a>
</p></div>
-->
  #} {#
  <!--        <form>
             <input type="file" id="inputJSON" />
             <input type="submit" value="Submit" />

                 var calories = {{ calories | tojson | safe }};
    var protein =  {{ protein | tojson | safe }};
    var fat = {{ fat | tojson | safe }};
    var carbs = {{ carbs | tojson | safe }};

        var UserInput = function() {

        this.calories = {{calories}} || 0;
        this.protein = {{protein}} || 0;
        this.fat = {{fat}} || 0;
        this.carbs = {{carbs}} || 0;

        this.gender = {{gender}} || "Male";
        this.age = {{age}} || 25;
    };


        </form>


    <script type="text/javascript">

    var userJsonToRun = {"nutrientTargets": { "calories": {{calories}},
     "protein": {{protein}}, "fat": {{fat}},
     "carbs": {{carbs}}, "name": "{{email}}",
     "gender": {{gender}}, "age": {{age}} }};

    </script>
    <script type="text/javascript" src="js/defaultJson.js"></script>-->#} {#
  <!--       <textarea id="ingredientform" name = "ingredientform" rows="10">
        <div id="ingredientTableJson" class="col-xs-4"></div>
    </textarea>
     {{ ingredientform.json }}
    {{ ingredientform.submit }}
    {{ wtf.quick_form(ingredientform) }}

    {{ wtf.quick_form(ingredientform) }}
    {{ ingredientform.json }}
    {{ ingredientform.hidden(id='ingredientTableJsonVal') }}
    {{ ingredientform.submit }}
    </div>

<form action="/" method="post">
    {{ ingredientform.json }}
    {{ ingredientform.hidden(id='ingredientTableJsonVal') }}
    {{ ingredientform.submit }}
</form>

    <div class="col-xs-4">
    <h3>JSON Here!!!!!!!!!</h3>
    {{ json }}
    </div>

<p>{{hiddenform}}</p>   -->#} {#
  <!--
{{ ingredientform.json(placeholder="json", id = "ingredientTableJsonVal") }}
{{ ingredientform.submit }}


<div class="form-group">
<input type="hidden" name="hiddenform" class="text-field form-control validate-field required" data-validation-type="neighborhood" id="nbhd" placeholder="Pick One" value="Pick One">
</div>

        <input id="chag_sort" type="hidden" name="chag_sort">

        <script type="text/javascript">
            $("#chag_sort").val(sort2);
        </script>
-->#} {#
  <!--
    <p></p>
    <div class="container col-xs-12">
    <h2>What is this?</h2>
    <p>Genetic Soylent is an attempt to automatically create a Soylent recipe given a list of ingredients and a target nutrient profile.</p>
    <p>You can play with it by pressing <i class="icon-step-forward"></i> to step to the next generation, <i class="icon-play"></i> to step to next generations automatically and <i class="icon-refresh"></i> to reset the simulation.</p>
    <p>Original code by nick: <a href="http://github.com/nick/genetic-soylent">http://github.com/nick/genetic-soylent</a></p>
    <p>This version by 2potatoes: <a href="http://github.com/2potatoes/genetic-soylent">http://github.com/2potatoes/genetic-soylent</a></p>
    <p>Notes on genetic soylent can be found on <a href="http://spudlent.blogspot.com/search/label/Genetic%20Soylent">2potatoes blog</a>.</p>
    <h2>How it works</h2>
    <ul>
        <li>Generate 100 recipes, each recipe containing a random amount of each ingredient.</li>
        <li>Score each recipe based on how close all the nutrients are to 100%.</li>
        <li>Sort the recipes from best to worst.</li>
        <li>Show the best one in the table above.</li>
    </ul>
    <p>On each subsequent 'generation', the following happens:</p>
    <ul>
        <li>Remove the worst 30 recipes from the list</li>
        <li>Create 30 new Child recipes containing ingredient amounts taken from two randomly selected Parent recipes.</li>
        <li>Ingredient amounts in each Child can also be mutated if the 'mutation probability' is met.</li>
        <li>A mutation works by taking a random ingredient and increasing or decreasing the amount defined by the 'mutation multiplier'. For example, a mutation multiplier of 0.1 will increase or decrease the amount of an ingredient by 10%.</li>
        <li>Finally, we re-calculate the scores for each recipe, sort them, and show the best one in the table.</li>
    </ul>

    </div>
    -->
  #}
